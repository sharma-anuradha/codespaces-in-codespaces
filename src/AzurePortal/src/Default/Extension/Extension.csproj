<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props') And '$(EnvironmentConfig)' == ''" />
  <Import Project="$(EnvironmentConfig)" Condition="'$(EnvironmentConfig)' != ''" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <TargetFrameworkVersion>v4.7.2</TargetFrameworkVersion>
    <FileUpgradeFlags></FileUpgradeFlags>
    <UpgradeBackupLocation></UpgradeBackupLocation>
    <OldToolsVersion>4.0</OldToolsVersion>
    <CreateInPlace>true</CreateInPlace>
    <NuGetPackageImportStamp>9b1bd434</NuGetPackageImportStamp>
    <GalleryPackagesSourceFolder>$(ProjectDir)GalleryPackages</GalleryPackagesSourceFolder>
    <SignAssembly>false</SignAssembly>
    <PublicSign>false</PublicSign>
    <BladeReferencesCodegenMode>Definitions</BladeReferencesCodegenMode>
    <PartReferencesCodegenMode>Definitions</PartReferencesCodegenMode>
	  <BaseIntermediateOutputPath>obj\</BaseIntermediateOutputPath>
  </PropertyGroup>
  <PropertyGroup>
    <SchemaVersion>2.0</SchemaVersion>
    <ProjectGuid>{6C088569-F0CE-4367-B087-EE77D4A4252A}</ProjectGuid>
    <OutputType>Library</OutputType>
    <AppDesignerFolder>Properties</AppDesignerFolder>
    <RootNamespace>Microsoft.Portal.Extensions.ExtensionTemplate</RootNamespace>
    <AssemblyName>Microsoft.Portal.Extensions.ExtensionTemplate</AssemblyName>
    <OutputPath>bin\</OutputPath>
    <PackagesDir>$([System.IO.Path]::Combine($(MSBuildThisFileDirectory), "..\..\packages"))</PackagesDir>
    <!-- $(ExtensionPageVersion) below specifies the version of the extension. Ensure that the value is different with each official build. -->
    <ExtensionPageVersion>1.0.0.2</ExtensionPageVersion>
    <PortalEmitTypeMetadataTypeScript>true</PortalEmitTypeMetadataTypeScript>
    <PortalEmitTypeMetadataTypeScriptTargetFolder>Client\_generated</PortalEmitTypeMetadataTypeScriptTargetFolder>
    <EnableFastExtensionLoad>true</EnableFastExtensionLoad>
    <EnablePrewarming>true</EnablePrewarming>
  </PropertyGroup>
  <PropertyGroup>
    <RunBundlerInDevMode Condition="'$(RunBundlerInDevMode)' == '' AND '$(Configuration)' == 'Debug'">true</RunBundlerInDevMode>
    <RunBundlerInDevMode Condition="'$(RunBundlerInDevMode)' == '' AND '$(Configuration)' != 'Debug'">false</RunBundlerInDevMode>
  </PropertyGroup>
  <PropertyGroup>
    <!-- produce the hosting service package if not running in local hosting service dev mode -->
    <HostingServiceCreateDeploymentArtifacts Condition="'$(RunBundlerInDevMode.ToLower())' == 'false'">true</HostingServiceCreateDeploymentArtifacts>
    <HostingServiceRoutePrefix>codespaces</HostingServiceRoutePrefix>
    <HostingServicePackageOutputRootDir>$(OutputPath)\Deployment</HostingServicePackageOutputRootDir>
  </PropertyGroup>
  <PropertyGroup Condition="'$(RunBundlerInDevMode.ToLower())' == 'true'">
    <!-- Configure csproj LocalHostingService dev server for F5 in visual studio to launch and sideload -->
    <StartAction>Program</StartAction>
    <StartProgram>$(COMSPEC)</StartProgram>
    <StartArguments>/k npm install --no-optional &amp;&amp; node node_modules\%40microsoft\portalhostingservice\DevServer\DevServer.js -s &amp; pause &amp; exit</StartArguments>
    <StartWorkingDirectory>$(MSBuildThisFileDirectory)</StartWorkingDirectory>
    <HostingServiceCreateDeploymentArtifacts>false</HostingServiceCreateDeploymentArtifacts>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' And '$(EnvironmentConfig)' == '' ">
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' And '$(EnvironmentConfig)' == '' ">
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="System" />
    <Reference Include="Microsoft.Azure.Gallery.Common">
      <HintPath>$(PackagesDir)\Microsoft.Azure.Gallery.Common.5.1.0.19\lib\net45\Microsoft.Azure.Gallery.Common.dll</HintPath>
    </Reference>
    <Reference Include="Newtonsoft.Json">
      <HintPath>$(PackagesDir)\Newtonsoft.Json.12.0.2\lib\net45\Newtonsoft.Json.dll</HintPath>
    </Reference>
  </ItemGroup>
  <ItemGroup>
    <Content Include="ServiceGroupRootReplacements.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <Content Include="tsconfig.json" />
    <None Include="Client\ClientResources.d.ts" />
    <None Include="Client\Shared\Endpoints.ts" />
    <None Include="Client\Shared\HttpClient.ts" />
    <None Include="Client\TypeReferences.d.ts" />
    <None Include="Client\Resource\Blades\Keys\ResourceKeysBlade.ts" />
    <None Include="Client\Resource\Blades\Codespaces\CodespacesBlade.ts" />
    <None Include="Client\Resource\Blades\Codespaces\CodespaceModels.ts" />
    <None Include="Client\Resource\Blades\Codespaces\CreateCodespaceBlade.ts" />
    <None Include="Client\Resource\Blades\Codespaces\CodespacesManager.ts" />
    <None Include="Client\Resource\Blades\Codespaces\HttpCodespacesManager.ts" />
    <None Include="Client\Resource\Blades\Overview\InfoTilesComponent\InfoTilesComponent.css" />
    <None Include="Client\Resource\Blades\Overview\InfoTilesComponent\InfoTilesComponent.ts" />
    <None Include="Client\Resource\Blades\Overview\MonitoringComponent\MonitoringComponent.css" />
    <None Include="Client\Resource\Blades\Overview\MonitoringComponent\MonitoringComponent.ts" />
    <None Include="Client\Resource\Blades\Overview\ResourceOverviewBlade.css" />
    <None Include="Client\Resource\Blades\Overview\ResourceOverviewBlade.html" />
    <None Include="Client\Resource\Blades\Overview\ResourceOverviewBlade.ts" />
    <None Include="Client\Resource\Create\CreateBlade.html" />
    <None Include="Client\Resource\Create\CreateBlade.ts" />
    <None Include="Client\Resource\PlansViewModel.ts" />
    <None Include="Client\Resource\ResourcePart.ts" />
    <None Include="Client\Resource\PlanResource.ts" />
    <None Include="Client\Shared\Icons.ts" />
    <Svg Include="Content\SVG\sample.svg" />
    <Svg Include="Content\SVG\engine.svg" />
    <Svg Include="Content\SVG\msi.svg" />
    <AvailableItemName Include="Svg">
      <Visible>False</Visible>
    </AvailableItemName>
    <Content Include="Content\Config\default.json" />
    <Content Include="Content\Config\df.onecloud.azure-test.net.json" />
    <Content Include="Content\Config\portal.azure.cn.json" />
    <Content Include="Content\Config\portal.azure.com.json" />
    <Content Include="Content\Config\portal.azure.us.json" />
    <Content Include="Content\Config\portal.microsoftazure.de.json" />
    <PortalDefinition Include="Client\Resource\Browse.pdl">
      <SubType>Designer</SubType>
    </PortalDefinition>
    <None Include="GalleryPackages\Create\Icons\Large.png" />
    <None Include="GalleryPackages\Create\Icons\Medium.png" />
    <None Include="GalleryPackages\Create\Icons\Small.png" />
    <None Include="GalleryPackages\Create\Icons\Wide.png" />
    <None Include="GalleryPackages\Create\Screenshots\Image01.png" />
    <None Include="GalleryPackages\Create\strings\resources.resjson" />
    <None Include="Client\Shared\Constants.ts" />
    <PortalDefinition Include="Client\extension.pdl">
      <SubType>Designer</SubType>
    </PortalDefinition>
    <Content Include="packages.config">
      <SubType>Designer</SubType>
    </Content>
    <PortalDefinition Include="Client\**\*.dx.json" />
    <PortalDefinition Include="Client\**\*.dx.jsonc" />
    <Content Include="Client\_extensions\Hubs\HubsExtension.d.ts" />
    <ExtensionReference Include="Client\_extensions\Hubs\HubsExtension.pde" />
    <ExtensionReference Include="Client\_extensions\AAD\Microsoft_Azure_AD.pde" />
    <Content Include="App_Data\Gallery\Microsoft.GalleryPackage.1.0.1-preview.azpkg">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </Content>
    <None Include="GalleryPackages\Create\DeploymentTemplates\CreateResource.json" />
    <None Include="GalleryPackages\Create\Manifest.json" />
    <None Include="GalleryPackages\Create\UIDefinition.json" />
    <None Include="Definitions\*.d.ts" />
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Client\ClientResources.Designer.cs">
      <AutoGen>True</AutoGen>
      <DesignTime>True</DesignTime>
      <DependentUpon>ClientResources.resx</DependentUpon>
    </Compile>
  </ItemGroup>
  <ItemGroup>
    <EmbeddedResource Include="Client\ClientResources.resx">
      <Generator>PublicResXFileCodeGenerator</Generator>
      <BundleId>SamplesExtension</BundleId>
      <SubType>Designer</SubType>
      <LastGenOutput>ClientResources.Designer.cs</LastGenOutput>
    </EmbeddedResource>
  </ItemGroup>
  <PropertyGroup>
    <!-- default to v16.0 if it exsts else fallback to 15.0 -->
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' And Exists('$(MSBuildToolsPath)\..\..\Microsoft\VisualStudio\v16.0')">16.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' And Exists('$(MSBuildToolsPath)\..\..\Microsoft\VisualStudio\v15.0')">15.0</VisualStudioVersion>
  </PropertyGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" Condition="'$(ExtendedTargetsPath)' == ''" />
  <Import Project="$(ExtendedTargetsPath)\Microsoft.CSharp.targets" Condition="'$(ExtendedTargetsPath)' != ''" />
  <!--Target GenerateTargetFrameworkMonikerAttribute is generating a file that is being placed in the out folder resulting in build breaks -->
  <Target Name="GenerateTargetFrameworkMonikerAttribute" />
  <Import Project="$(PackagesDir)\Microsoft.Portal.Tools.6.317.0.5\build\Microsoft.Portal.Tools.targets" Condition="Exists('$(PackagesDir)')" />
  <Import Project="$(PackagesDir)\Microsoft.Azure.Gallery.AzureGalleryUtility.5.1.0.19\build\Microsoft.Azure.Gallery.AzureGalleryUtility.targets" Condition="Exists('$(PackagesDir)')" />
  <Target Name="CopyDependencies" BeforeTargets="BeforeBuild">
    <!-- Copy typings and pde files to the project for use in build systems like CoreXt that can't depend on using msbuild <Link /> and a relative path to the NuGet packages within tsconfig.json -->
    <ItemGroup>
      <ToolsTypeDefinitions Include="$(PackagesDir)\Microsoft.Portal.Tools.6.317.0.5\content\Definitions\**\*.d.ts" />
      <HubsPdeDeps Include="$(PackagesDir)\Microsoft.Portal.Extensions.Hubs.6.317.0.5\content\**\*" />
      <AADPdeDeps Include="$(PackagesDir)\Microsoft.Portal.Extensions.AAD.1.0.0.651\content\**\*" />
    </ItemGroup>
    <Copy SkipUnchangedFiles="true" SourceFiles="@(ToolsTypeDefinitions)" DestinationFiles="@(ToolsTypeDefinitions->'$(MSBuildThisFileDirectory)\Definitions\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SkipUnchangedFiles="true" SourceFiles="@(HubsPdeDeps)" DestinationFiles="@(HubsPdeDeps->'$(MSBuildThisFileDirectory)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Copy SkipUnchangedFiles="true" SourceFiles="@(AADPdeDeps)" DestinationFiles="@(AADPdeDeps->'$(MSBuildThisFileDirectory)\%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>
  <Target Name="SetExtensionPageVersion" BeforeTargets="CompilePdl">
    <PropertyGroup>
      <ExtensionPageVersion>$(CDP_MAJOR_NUMBER_ONLY).$(CDP_MINOR_NUMBER_ONLY).$([System.DateTime]::Now.ToString("yyyyMMdd")).$(CDP_DEFINITION_BUILD_COUNT_MONTH)</ExtensionPageVersion>
    </PropertyGroup>
  </Target>
</Project>
