<Project>

  <PropertyGroup>
    <GitRoot>$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), '.gitignore'))\</GitRoot>
    <SourceRoot>$(GitRoot)src\</SourceRoot>
    <BuildScriptsDir>$(GitRoot)build\</BuildScriptsDir>
    <Configuration Condition="'$(Configuration)'==''">Debug</Configuration>
    <BaseOutputPath>$(GitRoot)bin\$(Configuration.ToLowerInvariant())\</BaseOutputPath>
    <OutputPath>$(BaseOutputPath)$(MSBuildProjectName)\</OutputPath>
    <PackageOutputPath>$(BaseOutputPath)nupkgs\</PackageOutputPath>
    <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
    <BaseIntermediateOutputPath>$(GitRoot)bin\obj\$(MSBuildProjectName)\</BaseIntermediateOutputPath>
    <IsTraversal Condition="'$(MSBuildProjectFile)'=='dirs.proj'">true</IsTraversal>
    <AssemblyName>Microsoft.VsCloudKernel.Services.$(MSBuildProjectName)</AssemblyName>
  </PropertyGroup>
  
  <!-- Compiler options -->
  <PropertyGroup>
    <Deterministic>true</Deterministic>
  </PropertyGroup>

  <!-- .Net Targets -->
  <PropertyGroup>
    <NetCoreAppTargetFramework>netcoreapp2.2</NetCoreAppTargetFramework>
    <NetStandardTargetFramework>netstandard2.0</NetStandardTargetFramework>
  </PropertyGroup>

  <!-- NuGet Package Versions -->
  <PropertyGroup>
    <AdalVersion>4.5.1</AdalVersion>
    <AspNetCoreAppVersion>2.2.3</AspNetCoreAppVersion>
    <AspNetCoreDllVersions>2.2.0</AspNetCoreDllVersions>
    <IdentityClient>3.0.0-preview</IdentityClient>
    <IdentityModelS2SVersion>3.0.0-preview-60213030153</IdentityModelS2SVersion>
    <IdentiyModelVersion>6.0.0-preview-60212030309</IdentiyModelVersion>
    <NerdBankGitVersioningVersion>2.2.13</NerdBankGitVersioningVersion>
    <OctokitVersion>0.32.0</OctokitVersion>
    <VisualStudioValidationVersion>15.3.58</VisualStudioValidationVersion>
    <VsclkSdkVersion>0.1.10</VsclkSdkVersion>
    <AzureContainersToolsVersion>1.4.10</AzureContainersToolsVersion>
    <NewtonsoftJsonVersion>12.0.1</NewtonsoftJsonVersion>
  </PropertyGroup>

  <Choose>
    <When Condition="'$(IsTraversal)'!='true'">
      <!-- Common Package Refs -->
      <ItemGroup>
        <PackageReference Include="Microsoft.VisualStudio.Validation" Version="$(VisualStudioValidationVersion)" />
      </ItemGroup>
      <!-- Versioning Support -->
      <ItemGroup Condition="'$(IsTraversal)'!='true'">
        <PackageReference Include="Nerdbank.GitVersioning" Version="$(NerdBankGitVersioningVersion)" PrivateAssets="All" />
      </ItemGroup>
      <ItemGroup>
        <!-- All projects need to be rebuilt if the version changes. -->
        <Content Include="$(MSBuildThisFileDirectory)version.json" Link="version.json">
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
          <Visible>false</Visible> <!-- Hide from VS solution explorer -->
          <Pack>false</Pack> <!--Exclude from NuGet Packages -->
        </Content>
      </ItemGroup>
    </When>
  </Choose>

</Project>
