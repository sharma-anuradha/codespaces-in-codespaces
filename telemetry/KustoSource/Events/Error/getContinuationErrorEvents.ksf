#function("Last error on the continuation events.")
(T:(level: string, 
    ["time"]: datetime, 
    WorkspaceId: string, 
    ErrorDetail: string, 
    ErrorMessage: string, 
    ContinuationPayloadTrackingInstanceId: string))
{
    T
        | where level == "error"
        | where WorkspaceId != "" and ContinuationPayloadTrackingInstanceId != ""
        | extend EventAtContinuationHasError = 1
        | extend EventAtContinuationHasError_Time = ["time"]
        | extend EventAtContinuationHasError_WorkspaceId = WorkspaceId
        | extend EventAtContinuationHasError_ContinuationPayloadTrackingInstanceId = ContinuationPayloadTrackingInstanceId
        | extend EventAtContinuationHasError_ErrorDetail = ErrorDetail
        | extend EventAtContinuationHasError_ErrorMessage = ErrorMessage
        | project EventAtContinuationHasError, 
                EventAtContinuationHasError_Time, 
                EventAtContinuationHasError_WorkspaceId,
                EventAtContinuationHasError_ContinuationPayloadTrackingInstanceId,
                EventAtContinuationHasError_ErrorDetail,
                EventAtContinuationHasError_ErrorMessage
        | summarize arg_min(EventAtContinuationHasError_Time, *) by EventAtContinuationHasError_ContinuationPayloadTrackingInstanceId, EventAtContinuationHasError_WorkspaceId
}