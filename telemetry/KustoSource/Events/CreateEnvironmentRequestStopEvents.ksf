#include("CreateEnvironmentPOSTRequestEvents.ksf")
let CreateEnvironmentRequestStopEvents = CreateEnvironmentPOSTRequestEvents
    | where msg == "request_stop" 
    | extend EventAtCreateRequestStop = 1
    | extend EventAtCreateRequestStop_ResponseCode = toint(HttpResponseStatus)
    | extend EventAtCreateRequestStop_Time = ["time"]
    | extend EventAtCreateRequestStop_CorrelationId = CorrelationId
    | extend EventAtCreateRequestStop_SkuName = SkuName
    | project EventAtCreateRequestStop,
        EventAtCreateRequestStop_ResponseCode, 
        EventAtCreateRequestStop_Time, 
        EventAtCreateRequestStop_CorrelationId, 
        EventAtCreateRequestStop_SkuName
    | summarize arg_max(EventAtCreateRequestStop_Time, *) by EventAtCreateRequestStop_CorrelationId;
