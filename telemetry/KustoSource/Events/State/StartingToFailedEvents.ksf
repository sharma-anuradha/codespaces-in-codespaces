#include("GetStateTransitionEvents.ksf")
let StartingToFailedEvents = GetStateTransitionEvents(fromState="Starting", toState="Failed")
    | extend EventAtStartingToFailed = 1
    | extend EventAtStartingToFailed_UserAttributed = iff(CloudEnvironmentFailedStateReason == "user", 1, 0)
    | extend EventAtStartingToFailed_ViaHeartbeat = iff(HttpRequestUri == "/api/v1/heartbeat" and HttpRequestMethod == "POST", 1, 0)
    | extend EventAtStartingToFailed_Time = ['time']
    | extend EventAtStartingToFailed_CorrelationId = CorrelationId
    | extend EventAtStartingToFailed_WorkspaceId = WorkspaceId
    | project EventAtStartingToFailed, 
        EventAtStartingToFailed_UserAttributed, 
        EventAtStartingToFailed_ViaHeartbeat, 
        EventAtStartingToFailed_Time, 
        EventAtStartingToFailed_CorrelationId, 
        EventAtStartingToFailed_WorkspaceId;