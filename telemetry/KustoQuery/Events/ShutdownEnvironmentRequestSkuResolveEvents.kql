// WARNING: AUTO GENERATED BY KUSTO COMPILER.
// See vsclk-core repository for details.
// Source File: Events\ShutdownEnvironmentRequestSkuResolveEvents.ksf
// Scoped events for last 7 days and on prod ring.
let ScopedRawEvents = DefaultEvent
    | where ['time'] between (ago(7d) .. now())
    | where ServiceEnvironment == "vsclk-online-prod";
let ShutdownEnvironmentPOSTRequestEvents = ScopedRawEvents
    | where HttpRequestMethod == "POST" and HttpRequestUri startswith "/api/v1/environments" and HttpRequestUri endswith "/shutdown";
let ShutdownEnvironmentRequestSkuResolveEvents = ShutdownEnvironmentPOSTRequestEvents
    | where msg == "environmentstatemanager_setenvironmentstateasync"
    | extend EventAtShutdownSkuResolve = 1
    | extend EventAtShutdownSkuResolve_Time = ["time"]
    | extend EventAtShutdownSkuResolve_CorrelationId = CorrelationId
    | extend EventAtShutdownSkuResolve_SkuName = SkuName
    | extend EventAtShutdownSkuResolve_WorkspaceId = WorkspaceId
    | project EventAtShutdownSkuResolve, 
        EventAtShutdownSkuResolve_Time, 
        EventAtShutdownSkuResolve_CorrelationId, 
        EventAtShutdownSkuResolve_SkuName, 
        EventAtShutdownSkuResolve_WorkspaceId;
