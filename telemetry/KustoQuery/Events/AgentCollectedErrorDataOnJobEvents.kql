// WARNING: AUTO GENERATED BY KUSTO COMPILER.
// See vsclk-core repository for details.
// Source File: Events\AgentCollectedErrorDataOnJobEvents.ksf
// Scoped events for last 7 days and on prod ring.
let ScopedRawEvents = DefaultEvent
    | where ['time'] between (ago(7d) .. now())
    | where ServiceEnvironment == "vsclk-online-prod";
// Error received from the Agent.
let AgentCollectedErrorDataOnJobEvents = ScopedRawEvents
        | where msg == "start_environment_handler_process_complete"
        | project CorrelationId, JobCollectedData
        | where JobCollectedData != ""
        | extend ParsedJobCollectedData = parse_json(JobCollectedData)
        | extend JobErrors = ParsedJobCollectedData.errors
        | where JobErrors != "[]"
        | extend EventAtAgentCollectedError_JobError = JobErrors[0]
        | extend EventAtAgentCollectedError = 1
        | extend EventAtAgentCollectedError_CorrelationId = CorrelationId
        | project EventAtAgentCollectedError_CorrelationId, EventAtAgentCollectedError_JobError, EventAtAgentCollectedError;
